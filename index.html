<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="view-transition" content="same-origin" />
    <title>Grocery List Optimizer</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: linear-gradient(to bottom, #90ee90, #006400); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        .animation-container { position: relative; width: 100%; height: 100%; }
        .grocery-item { position: absolute; color: white; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); will-change: transform, opacity; cursor: pointer; }
        @keyframes fallAndFade { 0% { transform: translateY(var(--start-y)); opacity: 0; } 20% { opacity: var(--final-opacity); } 100% { transform: translateY(calc(100vh + 100px)); opacity: var(--final-opacity); } }
        .floating-container { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 500px; background-color: rgba(255, 255, 255, 0.3); padding: 20px; border-radius: 15px; box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); border: 1px solid rgba(255, 255, 255, 0.18); text-align: center; }
        .container-text { color: white; margin-bottom: 20px; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
        .search-container { position: relative; width: 100%; }
        .search-input { width: 100%; padding: 15px 20px; font-size: 18px; border: none; border-radius: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); outline: none; box-sizing: border-box; }
        .added-items-container { margin-top: 10px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; max-height: 110px; overflow-y: auto; padding-top: 5px; padding-bottom: 5px; }
        .added-item-bubble { background-color: rgba(100, 100, 255, 1); color: white; padding: 8px 15px; border-radius: 20px; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); animation: popIn 0.3s ease; position: relative; cursor: pointer; margin-top: 5px; }
        .remove-btn { position: absolute; top: -10px; right: -5px; background: #ff4d4d; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; line-height: 20px; text-align: center; cursor: pointer; opacity: 0; visibility: hidden; transform: scale(0.5); transition: opacity 0.2s, visibility 0.2s, transform 0.2s; }
        .added-item-bubble:hover .remove-btn, .added-item-bubble.selected .remove-btn { opacity: 1; visibility: visible; transform: scale(1); }
        .finalize-button { background-color: #FF9200; color: white; border: none; border-radius: 25px; padding: 12px 25px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: background-color 0.3s, transform 0.2s; }
        .finalize-button:hover { background-color: #218838; transform: translateY(-2px); }
        .store-selector-container { margin-top: 20px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .store-checkbox { background: rgba(255, 255, 255, 0.2); padding: 5px 10px; border-radius: 15px; display: flex; align-items: center; }
        .store-checkbox label { color: white; font-size: 14px; text-transform: capitalize; cursor: pointer; margin-left: 5px; }
        .store-checkbox input { cursor: pointer; }
        .store-selector-container .container-text { width: 100%; margin-bottom: 5px; }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.5); } }
    </style>
</head>
<body>
    <div id="animation-container" class="animation-container"></div>
    <div class="floating-container">
        <div class="container-text">
            <h2>Build Your Smart Shopping List</h2>
            <p>Enter your grocery items below or click on the falling items to add them to your list.</p>
        </div>
        <div class="search-container">
            <input type="search" id="grocery-input" class="search-input" placeholder="e.g., Apples, Milk, Bread...">
        </div>
        <div id="added-items" class="added-items-container"></div>
        <div id="store-selector-container">
             <p class="container-text" style="margin-bottom: 10px;">Select stores to search:</p>
        </div>
        <button id="finalize-btn" class="finalize-button">Optimize My List</button>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const groceryList=['Apples','Avocado','Bananas','Blueberries','Oranges','Strawberries','Grapes','Watermelon','Peaches','Cherries','Broccoli','Carrots','Cucumber','Garlic','Onions','Peppers','Potatoes','Spinach','Tomatoes','Lettuce','Mushrooms','Celery','Sweet Potatoes','Corn','Zucchini','Asparagus','Cabbage','Cauliflower','Eggplant','Kale','Beef','Chicken','Bacon','Fish','Sausage','Pork','Turkey','Shrimp','Lamb','Crab','Milk','Cheese','Eggs','Butter','Yogurt','Cream Cheese','Sour Cream','Cottage Cheese','Heavy Cream','Half & Half','Bread','Rice','Pasta','Cereal','Oats','Flour','Bagels','Tortillas','Quinoa','Pita Bread','Beans','Lentils','Nuts','Peanut Butter','Almonds','Walnuts','Cashews','Hummus','Tofu','Edamame','Soup','Crackers','Chips','Popcorn','Honey','Sugar','Jam','Pretzels','Granola Bars','Chocolate','Olive Oil','Ketchup','Mustard','Mayonnaise','Salsa','Soy Sauce','Vinegar','Hot Sauce','Spices','Herbs','Ice Cream','Juice','Soda','Coffee','Tea','Water','Beer','Wine','Pizza','Waffles'];
        const container=document.getElementById('animation-container');
        const MAX_ITEMS_ON_SCREEN=100;const ITEMS_STARTING_ON_SCREEN=40;
        let groceryIndex=0;function getRandom(t,e){return Math.random()*(e-t)+t}
        function getNextGroceryItem(){const t=groceryList[groceryIndex];return groceryIndex=(groceryIndex+1)%groceryList.length,t}
        function resetItem(t,e,o='0s'){t.style.left=`${getRandom(0,95)}vw`,t.style.fontSize=`${getRandom(16,40)}px`;const n=getRandom(.15,.55);t.style.setProperty('--final-opacity',n),e||(t.textContent=getNextGroceryItem());const a=e?`${getRandom(0,80)}vh`:'-100px';t.style.setProperty('--start-y',a);const r=`${getRandom(15,40)}s`;t.style.animation='none',t.offsetWidth,t.style.animation=`fallAndFade ${r} linear ${o} infinite backwards`}groceryList.sort(()=>.5-Math.random());
        for(let t=0;t<MAX_ITEMS_ON_SCREEN;t++){const e=document.createElement('span');e.className='grocery-item',e.textContent=getNextGroceryItem(),container.appendChild(e),e.addEventListener('click',function(){addItemBubble(this.textContent),this.style.display='none',setTimeout(()=>{this.style.display='',resetItem(this,!1,'0s')},2e3)}),t<ITEMS_STARTING_ON_SCREEN?resetItem(e,!0,'0s'):resetItem(e,!1,`${getRandom(0,20)}s`),e.addEventListener('animationiteration',()=>{resetItem(e,!1,'0s')})}
        const groceryInput=document.getElementById('grocery-input'),addedItemsContainer=document.getElementById('added-items');
        function addItemBubble(t){const e=document.createElement('div');e.className='added-item-bubble',e.textContent=t;const o=document.createElement('button');o.className='remove-btn',o.innerHTML='&times;',o.addEventListener('click',function(t){t.stopPropagation(),e.style.animation='fadeOut 0.3s forwards',e.addEventListener('animationend',()=>e.remove())}),e.appendChild(o),e.addEventListener('click',function(){document.querySelectorAll('.added-item-bubble.selected').forEach(t=>{t!==this&&t.classList.remove('selected')}),this.classList.toggle('selected')}),addedItemsContainer.appendChild(e)}groceryInput.addEventListener('keypress',function(t){'Enter'===t.key&&''!==this.value.trim()&&(addItemBubble(this.value.trim()),this.value='')});
        
        const stores = ["foodbasics", "nofrills", "freshco", "metro", "foodland", "gianttiger", "walmart", "loblaws"];
        const storeSelectorContainer = document.getElementById('store-selector-container');
        const checkboxesHtml = stores.map(store => `
            <div class="store-checkbox">
                <input type="checkbox" id="${store}" name="store" value="${store}" checked>
                <label for="${store}">${store}</label>
            </div>
        `).join('');
        storeSelectorContainer.insertAdjacentHTML('beforeend', checkboxesHtml);

        const finalizeBtn = document.getElementById('finalize-btn');
        const repoName = window.location.pathname.split('/')[1];
        const basePath = window.location.hostname.includes('github.io') ? `/${repoName}/` : '/';
        finalizeBtn.addEventListener('click', function() {
            const itemsToSearch = [];
            document.querySelectorAll('.added-item-bubble').forEach(bubble => {
                itemsToSearch.push(bubble.childNodes[0].nodeValue.trim());
            });

            if (itemsToSearch.length === 0) {
                alert('Please add some items to your list first!');
                return;
            }

            const selectedStores = [];
            document.querySelectorAll('#store-selector-container input[type="checkbox"]:checked').forEach(checkbox => {
                selectedStores.push(checkbox.value);
            });

            if (selectedStores.length === 0) {
                alert('Please select at least one store to search!');
                return;
            }

            const query = encodeURIComponent(itemsToSearch.join(','));
            const storesQuery = encodeURIComponent(selectedStores.join(','));
            const resultsUrl = `${basePath}results.html?q=${query}&stores=${storesQuery}`;
            
            window.location.href = resultsUrl;
        });
    });
    </script>
</body>
</html>